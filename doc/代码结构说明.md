# å²©çŸ³å›¾åƒåˆ†ç±»é¡¹ç›® - ä»£ç ç»“æ„è¯´æ˜

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
Rock-images-classify-with-CNN/
â”œâ”€â”€ requirements.txt              # é¡¹ç›®ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ doc/                         # ğŸ“š é¡¹ç›®æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ é¡¹ç›®è¯´æ˜.md               # é¡¹ç›®æ¦‚è¿°å’Œä»‹ç»
â”‚   â”œâ”€â”€ ä½¿ç”¨æŒ‡å—.md               # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ ä»£ç ç»“æ„è¯´æ˜.md           # ä»£ç æ¶æ„ä»‹ç»(æœ¬æ–‡ä»¶)
â”‚   â”œâ”€â”€ ä¼˜åŒ–æŠ¥å‘Š.md               # æ€§èƒ½ä¼˜åŒ–è¯¦æƒ…
â”‚   â””â”€â”€ ç³»ç»Ÿæ¶æ„.md               # æŠ€æœ¯æ¶æ„è¯´æ˜
â”œâ”€â”€ src/                         # ğŸš€ æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py                  # â­ ä¸»è®­ç»ƒè„šæœ¬ (ç»Ÿä¸€å…¥å£)
â”‚   â”œâ”€â”€ config.py                # âš™ï¸ é…ç½®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ data_loader.py           # ğŸ“Š æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
â”‚   â”œâ”€â”€ models.py                # ğŸ§  æ¨¡å‹å®šä¹‰æ¨¡å—
â”‚   â”œâ”€â”€ trainer.py               # ğŸƒ è®­ç»ƒå™¨æ¨¡å—
â”‚   â”œâ”€â”€ ensemble.py              # ğŸ¤ é›†æˆå­¦ä¹ æ¨¡å—
â”‚   â”œâ”€â”€ utils.py                 # ğŸ”§ å·¥å…·å‡½æ•°æ¨¡å—
â”‚   â”œâ”€â”€ Rock Data/               # ğŸ“Š å²©çŸ³å›¾åƒæ•°æ®é›†
â”‚   â”‚   â”œâ”€â”€ train/               # è®­ç»ƒé›† (3,687å¼ å›¾ç‰‡)
â”‚   â”‚   â”œâ”€â”€ valid/               # éªŒè¯é›† (351å¼ å›¾ç‰‡)
â”‚   â”‚   â””â”€â”€ test/                # æµ‹è¯•é›† (174å¼ å›¾ç‰‡)
â”‚   â”œâ”€â”€ models/                  # ğŸ’¾ æ¨¡å‹ä¿å­˜ç›®å½•
â”‚   â”œâ”€â”€ results/                 # ğŸ“ˆ è®­ç»ƒç»“æœç›®å½•
â”‚   â””â”€â”€ best_*.pth               # ğŸ† è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
```

## ğŸŒŸ æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### 1. ä¸»è®­ç»ƒè„šæœ¬ (`main.py`) - ç»Ÿä¸€å…¥å£

**åŠŸèƒ½**: é¡¹ç›®çš„æ ¸å¿ƒå…¥å£ï¼Œæ•´åˆäº†æ‰€æœ‰è®­ç»ƒåŠŸèƒ½
**ç‰¹ç‚¹**: 
- ğŸ¯ ä¸€ä¸ªè„šæœ¬è§£å†³æ‰€æœ‰è®­ç»ƒéœ€æ±‚
- ğŸ”§ æ”¯æŒå‘½ä»¤è¡Œå‚æ•°é…ç½®
- ğŸš€ å¤šç§è®­ç»ƒæ¨¡å¼ (quick/fast/full)
- ğŸ¤ å•æ¨¡å‹å’Œé›†æˆå­¦ä¹ æ”¯æŒ

**ä¸»è¦åŠŸèƒ½**:
```python
def parse_arguments()          # è§£æå‘½ä»¤è¡Œå‚æ•°
def update_config()            # æ›´æ–°é…ç½®å‚æ•°
def create_efficient_model()   # åˆ›å»ºä¼˜åŒ–æ¨¡å‹
def get_optimized_data_loaders() # è·å–æ•°æ®åŠ è½½å™¨
def train_single_model()       # å•æ¨¡å‹è®­ç»ƒ
def train_ensemble_models()    # é›†æˆå­¦ä¹ è®­ç»ƒ
def main()                     # ä¸»å‡½æ•°å…¥å£
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
python main.py --mode fast              # å¿«é€Ÿè®­ç»ƒ
python main.py --ensemble --epochs 30   # é›†æˆå­¦ä¹ 
python main.py --model resnet50 --epochs 50  # è‡ªå®šä¹‰è®­ç»ƒ
```

### 2. é…ç½®ç®¡ç† (`config.py`) - å‚æ•°ä¸­å¿ƒ

**åŠŸèƒ½**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¶…å‚æ•°å’Œç³»ç»Ÿé…ç½®
**ç‰¹ç‚¹**: 
- ğŸ›ï¸ é›†ä¸­å¼é…ç½®ç®¡ç†
- ğŸ“ è¯¦ç»†çš„å‚æ•°è¯´æ˜
- ğŸ”„ æ˜“äºä¿®æ”¹å’Œæ‰©å±•

**ä¸»è¦é…ç½®ç±»åˆ«**:
```python
class Config:
    # æ•°æ®é…ç½®
    IMAGE_SIZE = 224           # å›¾åƒå°ºå¯¸
    BATCH_SIZE = 32           # æ‰¹æ¬¡å¤§å°
    NUM_CLASSES = 9           # ç±»åˆ«æ•°é‡
    
    # è®­ç»ƒé…ç½®
    EPOCHS = 100              # è®­ç»ƒè½®æ•°
    LEARNING_RATE = 0.001     # å­¦ä¹ ç‡
    OPTIMIZER = 'adamw'       # ä¼˜åŒ–å™¨
    
    # æ¨¡å‹é…ç½®
    MODEL_TYPE = 'resnet50'   # æ¨¡å‹ç±»å‹
    PRETRAINED = True         # é¢„è®­ç»ƒæƒé‡
    DROPOUT_RATE = 0.5        # Dropoutç‡
    
    # ç³»ç»Ÿé…ç½®
    DEVICE = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    MIXED_PRECISION = True    # æ··åˆç²¾åº¦è®­ç»ƒ
```

### 3. æ•°æ®å¤„ç† (`data_loader.py`) - æ•°æ®å¼•æ“

**åŠŸèƒ½**: è´Ÿè´£æ•°æ®åŠ è½½ã€é¢„å¤„ç†å’Œå¢å¼º
**ç‰¹ç‚¹**: 
- ğŸ“Š æ™ºèƒ½æ•°æ®å¢å¼ºç­–ç•¥
- ğŸ”„ æ”¯æŒå¤šç§æ•°æ®é›†ç»“æ„
- âš¡ é«˜æ•ˆçš„æ‰¹é‡å¤„ç†

**æ ¸å¿ƒç±»**:
```python
class DataManager:
    def __init__(self, config)              # åˆå§‹åŒ–é…ç½®
    def _get_train_transform(self)          # è®­ç»ƒæ•°æ®å˜æ¢
    def _get_test_transform(self)           # æµ‹è¯•æ•°æ®å˜æ¢
    def get_data_loaders(self)              # è·å–æ•°æ®åŠ è½½å™¨
    def get_class_names(self)               # è·å–ç±»åˆ«åç§°
    def get_dataset_info(self)              # è·å–æ•°æ®é›†ä¿¡æ¯
```

**æ•°æ®å¢å¼ºç­–ç•¥**:
```python
transforms.Compose([
    transforms.Resize((224, 224)),                    # å°ºå¯¸è°ƒæ•´
    transforms.RandomRotation(30),                    # éšæœºæ—‹è½¬
    transforms.RandomHorizontalFlip(0.5),             # æ°´å¹³ç¿»è½¬
    transforms.ColorJitter(brightness=0.2),           # é¢œè‰²å˜æ¢
    transforms.RandomResizedCrop(224, scale=(0.8, 1.0)), # éšæœºè£å‰ª
    transforms.ToTensor(),                            # è½¬æ¢ä¸ºå¼ é‡
    transforms.Normalize([0.485, 0.456, 0.406],      # æ ‡å‡†åŒ–
                        [0.229, 0.224, 0.225])
])
```

### 4. æ¨¡å‹å®šä¹‰ (`models.py`) - æ¨¡å‹å·¥å‚

**åŠŸèƒ½**: å®šä¹‰å’Œåˆ›å»ºå„ç§æ·±åº¦å­¦ä¹ æ¨¡å‹
**ç‰¹ç‚¹**: 
- ğŸ§  æ”¯æŒå¤šç§å…ˆè¿›æ¶æ„
- ğŸ”§ æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- ğŸ¯ é’ˆå¯¹å²©çŸ³åˆ†ç±»ä¼˜åŒ–

**æ”¯æŒçš„æ¨¡å‹**:
```python
def get_model(model_type, num_classes, pretrained, dropout_rate):
    if model_type == 'custom_cnn':
        return ImprovedCNN()           # è‡ªå®šä¹‰CNN
    elif model_type.startswith('resnet'):
        return ResNetModel()           # ResNetç³»åˆ—
    elif model_type.startswith('efficientnet'):
        return EfficientNetModel()     # EfficientNetç³»åˆ—
```

**æ¨¡å‹æ¶æ„**:
- **ResNetç³»åˆ—**: ResNet18/34/50/101
- **EfficientNetç³»åˆ—**: EfficientNet-B0/B1
- **è‡ªå®šä¹‰CNN**: é’ˆå¯¹å²©çŸ³åˆ†ç±»ä¼˜åŒ–çš„ç½‘ç»œ
- **é›†æˆæ¨¡å‹**: å¤šæ¨¡å‹èåˆæ¶æ„

### 5. è®­ç»ƒå™¨ (`trainer.py`) - è®­ç»ƒå¼•æ“

**åŠŸèƒ½**: ç®¡ç†å®Œæ•´çš„è®­ç»ƒæµç¨‹
**ç‰¹ç‚¹**: 
- ğŸƒ å®Œæ•´çš„è®­ç»ƒå¾ªç¯
- ğŸ“ˆ å®æ—¶æ€§èƒ½ç›‘æ§
- ğŸ’¾ è‡ªåŠ¨æ¨¡å‹ä¿å­˜
- ğŸ›‘ æ™ºèƒ½æ—©åœæœºåˆ¶

**æ ¸å¿ƒåŠŸèƒ½**:
```python
class Trainer:
    def __init__(self, model, train_loader, valid_loader, test_loader, config)
    def train_epoch(self)              # è®­ç»ƒä¸€ä¸ªepoch
    def validate_epoch(self)           # éªŒè¯ä¸€ä¸ªepoch
    def test(self)                     # æµ‹è¯•æ¨¡å‹
    def train(self)                    # å®Œæ•´è®­ç»ƒæµç¨‹
    def save_model(self, filename)     # ä¿å­˜æ¨¡å‹
    def load_model(self, filename)     # åŠ è½½æ¨¡å‹
    def plot_training_history(self)    # ç»˜åˆ¶è®­ç»ƒå†å²
```

**è®­ç»ƒç‰¹æ€§**:
- **æ··åˆç²¾åº¦è®­ç»ƒ**: åŠ é€Ÿè®­ç»ƒï¼ŒèŠ‚çœæ˜¾å­˜
- **å­¦ä¹ ç‡è°ƒåº¦**: ä½™å¼¦é€€ç«ã€é˜¶æ¢¯è¡°å‡ç­‰
- **æ—©åœæœºåˆ¶**: é˜²æ­¢è¿‡æ‹Ÿåˆ
- **è‡ªåŠ¨ä¿å­˜**: ä¿å­˜æœ€ä½³æ¨¡å‹æƒé‡

### 6. é›†æˆå­¦ä¹  (`ensemble.py`) - é›†æˆç­–ç•¥

**åŠŸèƒ½**: å®ç°å¤šæ¨¡å‹é›†æˆå­¦ä¹ 
**ç‰¹ç‚¹**: 
- ğŸ¤ å¤šç§é›†æˆç­–ç•¥
- ğŸ¯ è‡ªåŠ¨æ¨¡å‹è®­ç»ƒ
- ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ

**é›†æˆæ–¹æ³•**:
```python
class EnsembleTrainer:
    def train_individual_models(self)   # è®­ç»ƒå„ä¸ªæ¨¡å‹
    def voting_ensemble(self, method)   # æŠ•ç¥¨é›†æˆ
    def weighted_ensemble(self)         # åŠ æƒé›†æˆ
    def compare_methods(self)           # å¯¹æ¯”ä¸åŒæ–¹æ³•
```

**é›†æˆç­–ç•¥**:
- **ç¡¬æŠ•ç¥¨**: å¤šæ•°æŠ•ç¥¨å†³ç­–
- **è½¯æŠ•ç¥¨**: æ¦‚ç‡å¹³å‡
- **åŠ æƒé›†æˆ**: åŸºäºæ€§èƒ½çš„æƒé‡åˆ†é…

### 7. å·¥å…·å‡½æ•° (`utils.py`) - è¾…åŠ©å·¥å…·

**åŠŸèƒ½**: æä¾›è¯„ä¼°ã€å¯è§†åŒ–å’Œè¾…åŠ©åŠŸèƒ½
**ç‰¹ç‚¹**: 
- ğŸ“Š ä¸°å¯Œçš„è¯„ä¼°æŒ‡æ ‡
- ğŸ“ˆ ä¸“ä¸šçš„å¯è§†åŒ–å›¾è¡¨
- ğŸ”§ å®ç”¨çš„è¾…åŠ©å‡½æ•°

**ä¸»è¦åŠŸèƒ½**:
```python
def evaluate_model()           # æ¨¡å‹æ€§èƒ½è¯„ä¼°
def plot_confusion_matrix()    # ç»˜åˆ¶æ··æ·†çŸ©é˜µ
def plot_class_performance()   # ç»˜åˆ¶ç±»åˆ«æ€§èƒ½å›¾
def save_predictions()         # ä¿å­˜é¢„æµ‹ç»“æœ
def calculate_model_size()     # è®¡ç®—æ¨¡å‹å¤§å°
def print_model_info()         # æ‰“å°æ¨¡å‹ä¿¡æ¯
```

## ğŸ”„ æ•°æ®æµç¨‹å›¾

```
åŸå§‹å›¾åƒ â†’ æ•°æ®åŠ è½½ â†’ é¢„å¤„ç† â†’ æ•°æ®å¢å¼º â†’ æ¨¡å‹è®­ç»ƒ â†’ æ€§èƒ½è¯„ä¼° â†’ ç»“æœè¾“å‡º
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
Rock Data  DataManager Transform  Augment   Trainer   Utils    Reports
    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼         â–¼         â–¼         â–¼
  9ç±»å²©çŸ³   æ‰¹é‡åŠ è½½   å°ºå¯¸è°ƒæ•´   æ—‹è½¬ç¿»è½¬   æ¢¯åº¦æ›´æ–°   å‡†ç¡®ç‡    å¯è§†åŒ–
 4212å¼ å›¾   DataLoader  224x224   é¢œè‰²å˜æ¢   æŸå¤±è®¡ç®—   æ··æ·†çŸ©é˜µ   å›¾è¡¨
```

## ğŸ§© æ¨¡å—ä¾èµ–å…³ç³»

```
config.py (é…ç½®ä¸­å¿ƒ)
    â†‘
    â”‚ (è¢«æ‰€æœ‰æ¨¡å—å¯¼å…¥)
    â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â–¼                                        â–¼
data_loader.py                      models.py
    â†“                                   â†“
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼         â–¼
                trainer.py â†â†’ ensemble.py
                    â†“         â†“
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                   utils.py
                        â†“
                   main.py (ç»Ÿä¸€å…¥å£)
```

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ¨¡å—åŒ–è®¾è®¡
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½
- **ä½è€¦åˆ**: æ¨¡å—é—´ä¾èµ–å…³ç³»æ¸…æ™°
- **é«˜å†…èš**: ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—

### 2. å¯æ‰©å±•æ€§
- **æ’ä»¶å¼æ¶æ„**: æ˜“äºæ·»åŠ æ–°æ¨¡å‹
- **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶è¡Œä¸º
- **æ¥å£ç»Ÿä¸€**: æ ‡å‡†åŒ–çš„æ¨¡å—æ¥å£

### 3. æ˜“ç”¨æ€§
- **ç»Ÿä¸€å…¥å£**: ä¸€ä¸ªmain.pyè§£å†³æ‰€æœ‰éœ€æ±‚
- **æ™ºèƒ½é»˜è®¤**: åˆç†çš„é»˜è®¤å‚æ•°è®¾ç½®
- **è¯¦ç»†æ–‡æ¡£**: å®Œæ•´çš„ä½¿ç”¨è¯´æ˜

### 4. é«˜æ€§èƒ½
- **GPUä¼˜åŒ–**: æ”¯æŒCUDAåŠ é€Ÿè®­ç»ƒ
- **å†…å­˜ä¼˜åŒ–**: é«˜æ•ˆçš„æ•°æ®åŠ è½½
- **å¹¶è¡Œå¤„ç†**: å¤šè¿›ç¨‹æ•°æ®é¢„å¤„ç†

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æ¨¡å‹
1. åœ¨`models.py`ä¸­å®šä¹‰æ–°æ¨¡å‹ç±»
2. åœ¨`get_model()`å‡½æ•°ä¸­æ³¨å†Œæ–°æ¨¡å‹
3. åœ¨`main.py`çš„å‚æ•°é€‰é¡¹ä¸­æ·»åŠ æ–°æ¨¡å‹

### æ·»åŠ æ–°çš„æ•°æ®å¢å¼º
1. åœ¨`data_loader.py`ä¸­ä¿®æ”¹å˜æ¢æµç¨‹
2. åœ¨`config.py`ä¸­æ·»åŠ ç›¸å…³å‚æ•°
3. æµ‹è¯•æ–°å¢å¼ºçš„æ•ˆæœ

### æ·»åŠ æ–°çš„è®­ç»ƒç­–ç•¥
1. åœ¨`trainer.py`ä¸­å®ç°æ–°çš„è®­ç»ƒé€»è¾‘
2. åœ¨`config.py`ä¸­æ·»åŠ ç›¸å…³é…ç½®
3. åœ¨`main.py`ä¸­é›†æˆæ–°ç­–ç•¥

### æ·»åŠ æ–°çš„è¯„ä¼°æŒ‡æ ‡
1. åœ¨`utils.py`ä¸­å®ç°æ–°çš„è¯„ä¼°å‡½æ•°
2. åœ¨`trainer.py`ä¸­è°ƒç”¨æ–°çš„è¯„ä¼°
3. åœ¨å¯è§†åŒ–ä¸­å±•ç¤ºæ–°æŒ‡æ ‡

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶è§„æ¨¡
| æ–‡ä»¶ | è¡Œæ•° | ä¸»è¦åŠŸèƒ½ | å¤æ‚åº¦ |
|------|------|----------|--------|
| main.py | ~570 | ç»Ÿä¸€å…¥å£ï¼Œè®­ç»ƒæ§åˆ¶ | â­â­â­â­ |
| trainer.py | ~400 | è®­ç»ƒæµç¨‹ç®¡ç† | â­â­â­â­â­ |
| models.py | ~300 | æ¨¡å‹å®šä¹‰ | â­â­â­ |
| data_loader.py | ~200 | æ•°æ®å¤„ç† | â­â­â­ |
| utils.py | ~250 | å·¥å…·å‡½æ•° | â­â­ |
| ensemble.py | ~350 | é›†æˆå­¦ä¹  | â­â­â­â­ |
| config.py | ~100 | é…ç½®ç®¡ç† | â­ |

### åŠŸèƒ½åˆ†å¸ƒ
- **æ ¸å¿ƒè®­ç»ƒ**: 40% (main.py, trainer.py)
- **æ¨¡å‹å®šä¹‰**: 20% (models.py, ensemble.py)
- **æ•°æ®å¤„ç†**: 20% (data_loader.py)
- **å·¥å…·æ”¯æŒ**: 15% (utils.py)
- **é…ç½®ç®¡ç†**: 5% (config.py)

## ğŸ† æ¶æ„ä¼˜åŠ¿

### 1. ç»Ÿä¸€æ€§
- ä¸€ä¸ªmain.pyè§£å†³æ‰€æœ‰è®­ç»ƒéœ€æ±‚
- ç»Ÿä¸€çš„é…ç½®ç®¡ç†ç³»ç»Ÿ
- æ ‡å‡†åŒ–çš„æ¨¡å—æ¥å£

### 2. çµæ´»æ€§
- æ”¯æŒå¤šç§æ¨¡å‹æ¶æ„
- å¯é…ç½®çš„è®­ç»ƒç­–ç•¥
- çµæ´»çš„é›†æˆæ–¹æ¡ˆ

### 3. å¯ç»´æŠ¤æ€§
- æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
- è¯¦ç»†çš„ä»£ç æ³¨é‡Š
- å®Œæ•´çš„æ–‡æ¡£è¯´æ˜

### 4. é«˜æ€§èƒ½
- GPUåŠ é€Ÿæ”¯æŒ
- æ··åˆç²¾åº¦è®­ç»ƒ
- é«˜æ•ˆçš„æ•°æ®æµæ°´çº¿

è¿™ä¸ªä»£ç æ¶æ„ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ—¢ä¿è¯äº†åŠŸèƒ½çš„å®Œæ•´æ€§ï¼Œåˆç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œä¸ºå²©çŸ³å›¾åƒåˆ†ç±»ä»»åŠ¡æä¾›äº†ä¸€ä¸ªç¨³å®šã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚
